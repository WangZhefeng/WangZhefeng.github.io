---
title: NLP-fastText
author: 王哲峰
date: '2022-04-05'
slug: nlp-fasttext
categories:
  - NLP
tags:
  - tool
---

<script src="{{< blogdown/postref >}}index_files/header-attrs/header-attrs.js"></script>


<div id="fasttext-简介" class="section level1">
<h1>1.fastText 简介</h1>
<ul>
<li>官网:<a href="https://fasttext.cc/" class="uri">https://fasttext.cc/</a></li>
</ul>
<div id="快速开始" class="section level2">
<h2>1.1 快速开始</h2>
<div id="fasttext-是什么" class="section level3">
<h3>1.1.1 fastText 是什么</h3>
<p>fastText is a library for efficient learning of <strong>word representations</strong> and <strong>sentence classification</strong>.</p>
</div>
<div id="fasttext-环境依赖" class="section level3">
<h3>1.1.2 fastText 环境依赖</h3>
<ul>
<li><p>计算机系统</p>
<ul>
<li>macOS</li>
<li>Linux</li>
</ul></li>
<li><p>C++11 编译器</p>
<ul>
<li>(gcc-4.6.3 or newer) or (clang-3.3 or newer)</li>
<li>make</li>
</ul></li>
<li><p>Python 依赖</p>
<ul>
<li><blockquote>
<p>=python 2.6</p>
</blockquote></li>
<li>numpy</li>
<li>scipy</li>
</ul></li>
</ul>
</div>
<div id="fasttext-工具库构建" class="section level3">
<h3>1.1.3 fastText 工具库构建</h3>
<ol style="list-style-type: decimal">
<li>构建 fastText 为一个命令行工具(CLT)</li>
</ol>
<pre class="bash"><code>$ git clone https://github.com/facebookresearch/fastText.git
$ cd fastText
$ make</code></pre>
<p>或者:</p>
<pre class="bash"><code>$ wget https://github.com/facebookresearch/fastText/archive/v0.9.2.zip
$ unzip v0.9.2.zip
$ cd fastText-0.9.2
$ make</code></pre>
<ol start="2" style="list-style-type: decimal">
<li>构建 fastText 为一个 Python 模块</li>
</ol>
<pre class="bash"><code>$ git clone https://github.com/facebookresearch/fastText.git
$ cd fastText
$ sudo pip install .
# or
$ sudp python setup.py install</code></pre>
<p>或者:</p>
<pre class="bash"><code>$ wget https://github.com/facebookresearch/fastText/archive/v0.9.2.zip
$ unzip v0.9.2.zip
$ cd fastText-0.9.2
$ pip install</code></pre>
<pre class="python"><code>&gt;&gt;&gt; import fasttext
&gt;&gt;&gt;</code></pre>
<ol start="3" style="list-style-type: decimal">
<li>获取帮助:</li>
</ol>
<pre class="bash"><code>./fasttext</code></pre>
<pre class="python"><code>&gt;&gt;&gt; import fasttext
&gt;&gt;&gt; help(fasttext.FastText)</code></pre>
</div>
</div>
</div>
<div id="使用-fasttext-进行文本分类" class="section level1">
<h1>2.使用 fastText 进行文本分类</h1>
<p>文本分类可以应用在许多方面:</p>
<ul>
<li>spam detection</li>
<li>sentiment analysis</li>
<li>smart replies</li>
</ul>
<div id="准备文本数据" class="section level2">
<h2>2.1 准备文本数据</h2>
<ul>
<li>数据来源: <a href="https://cooking.stackexchange.com/" class="uri">https://cooking.stackexchange.com/</a></li>
<li>数据描述:
<ul>
<li>building a classifier to automatically recognize the topic of a stackexchange question about cooking</li>
</ul></li>
<li>数据下载</li>
</ul>
<pre class="bash"><code>
$ wget https://dl.fbaipublicfiles.com/fasttext/data/cooking.stackexchange.tar.gz
$ tar xvzf cooking.stackexchange.tar.gz
$ head cooking.stackexchange.txt
$ wc cooking.stackexchange.txt</code></pre>
<ul>
<li>数据格式预览</li>
</ul>
<p>============================================================================== ==============================================================================
Label document
============================================================================== ==============================================================================
__label__sauce __label__cheese How much does potato starch affect a cheese sauce recipe?
__label__food-safety __label__acidity Dangerous pathogens capable of growing in acidic environments
__label__cast-iron __label__stove How do I cover up the white spots on my cast iron stove?
__label__restaurant Michelin Three Star Restaurant; but if the chef is not there
__label__knife-skills __label__dicing Without knife skills, how can I quickly and accurately dice vegetables?
__label__storage-method __label__equipment __label__bread What’s the purpose of a bread box?
__label__baking __label__food-safety __label__substitutions __label__peanuts how to seperate peanut oil from roasted peanuts at home?
__label__chocolate American equivalent for British chocolate terms
__label__baking __label__oven __label__convection Fan bake vs bake
__label__sauce __label__storage-lifetime __label__acidity __label__mayonnaise Regulation and balancing of readymade packed mayonnaise and other sauces
============================================================================== ==============================================================================</p>
<ul>
<li><p>数据集分割</p>
<ul>
<li>Training dataset</li>
</ul></li>
</ul>
<pre class="bash"><code>$ head -n 12404 cooking.stackexchange.txt &gt; cooking.train
$ wc cooking.train</code></pre>
<pre><code>- validation dataset</code></pre>
<pre class="bash"><code>    $ tail -n 3000 cooking.stackexchange.txt &gt; cooking.valid
    $ wc cooking.valid</code></pre>
</div>
<div id="构建分类器" class="section level2">
<h2>2.2 构建分类器</h2>
<ul>
<li>基本模型</li>
</ul>
<pre class="python"><code>import fasttext

# 模型训练    
model = fasttext.train_supervised(input = &quot;cooking.train&quot;)

# 模型保存
model.save_model(&quot;model_cooking.bin&quot;)

# 模型测试
model.predict(&quot;Which baking dish is best to bake a banana bread ?&quot;)
model.predict(&quot;Why not put knives in the dishwater?&quot;)
model.test(&quot;cooking.valid&quot;)
model.test(&quot;cooking.valid&quot;, k = 5)</code></pre>
<ul>
<li>precision 和 recall</li>
</ul>
<pre class="python"><code># Top 5 预测标签，用来计算 precision 和 recall
model.predict(&quot;Why not put knives in the dishwater?&quot;, k = 5)</code></pre>
<ul>
<li><p>增强模型预测能力</p></li>
<li><p>(2)数据预处理</p>
<ul>
<li>将单词中的大写字母转换为小写字母</li>
<li>处理标点符号</li>
</ul></li>
</ul>
<pre class="bash"><code>$ cat cooking.stackexchange.txt | sed -e &quot;s/\([.\!?,&#39;/()]\)/ \1 /g&quot; | tr &quot;[:upper:]&quot; &quot;[:lower:]&quot; &gt; cooking.preprocessed.txt
$ head -n 12404 cooking.preprocessed.txt &gt; cooking_preprocessed.train
$ tail -n 3000 cooking.preprocessed.txt &gt; cooking_preprocessed.valid</code></pre>
<pre class="python"><code>import fasttext

model = fasttext.train_supervised(input = &quot;cooking_preprocessed.train&quot;)
model.test(&quot;cooking_preprocessed.valid&quot;)</code></pre>
<ul>
<li>(2)增多 epochs</li>
</ul>
<pre class="python"><code>import fasttext

model = fasttext.train_supervised(input = &quot;cooking.train&quot;, epoch = 25)
model.test(&quot;cooking.valid&quot;)</code></pre>
<ul>
<li>(3)增大 learning_rate</li>
</ul>
<pre class="python"><code>import fasttext

model = fasttext.train_supervised(input = &quot;cooking.train&quot;, lr = 1.0)
model.test(&quot;cooking.valid&quot;)</code></pre>
<pre class="python"><code>import fasttext

model = fasttext.train_supervised(input = &quot;cooking.train&quot;, lr = 1.0, epoch = 25)
model.test(&quot;cooking.valid&quot;)</code></pre>
<ul>
<li>(4)word n-grams</li>
</ul>
<pre class="python"><code>model = fasttext.train_supervised(
    input = &quot;cooking.train&quot;, 
    lr = 1.0, 
    epoch = 25, 
    wordNgrams = 2
)
model.test(&quot;cooking.valid&quot;)</code></pre>
<ul>
<li><p>Bigram</p></li>
<li><p>Scaling thing up</p></li>
</ul>
<pre class="python"><code>model = fasttext.train_supervised(
    input = &quot;cooking.train&quot;, 
    lr = 1.0, 
    epoch = 25, 
    wordNgrams = 2, 
    bucket = 200000, 
    dim = 50,
    loss = &quot;hs&quot;
)</code></pre>
<ul>
<li>多标签分类(Multi-label classification)</li>
</ul>
<pre class="python"><code>import fasttext

model = fasttext.train_supervised(
    input = &quot;cooking.train&quot;, 
    lr = 0.5, 
    epoch = 25, 
    wordNgrams = 2, 
    bucket = 200000, 
    dim = 50, 
    loss = &quot;ova&quot;
)

model.predict(
    &quot;Which baking dish is best to bake a banana bread ?&quot;, 
    k = -1,
    threshold = 0.5
)
model.test(&quot;cooking.valid&quot;, k = -1)</code></pre>
</div>
</div>
<div id="使用-fasttext-进行词表示" class="section level1">
<h1>3.使用 fastText 进行词表示</h1>
</div>
