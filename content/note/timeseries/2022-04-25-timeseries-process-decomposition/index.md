---
title: 时间序列预处理-分解
author: 王哲峰
date: '2022-04-25'
slug: timeseries-process-decomposition
categories:
  - timeseries
tags:
  - ml
---


# 时间序列分解模型

时间序列一般可以表示为四个因素的叠加:


   
$$Y_{t} = f(T_{t}, S_{t}, C_{t}, I_{t})$$

其中:

- 长期趋势因素(Secular trend) $T_{t}$
   - 长期趋势指序列在较长时期内持续变化的一种趋向或状态
- 季节变动因素(Seasonal Variation) $S_{t}$
   - 季节变动是由于季节的变化引起的序列发展水平的规则变动
- 周期性因素(Cyclical Variation) $C_{t}$
   - 周期变动指以若干年为期限, 不具有严格规则的周期性连续变动
- 随机变动因素(Irregular Variation) $I_{t}$
   - 不规则变动指由于众多偶然因素对时间序列造成的影响

时间序列分解法试图从时间序列中区分出这四种潜在的因素, 特别是长期趋势因素(T)、季节变动因素(S)、
周期性因素(C). 显然, 并非每一个预测对象中都存在着T、S、C这三种趋势, 可能是其中的一种或两种. 
一个具体的时间序列究竟由哪几类变动组合, 采取哪种组合形式, 应根据所掌握的资料、时间序列及研究目的来确定.

.. note:: 另外一种解释

   在时间序列分析中, 常见的分析方法叫做时间序列的分解(Decomposition of Time Series), 
   时间序列分解的原理是将时间序列 $y_{t}$ 分为三个部分: 

      - 季节性项 $S_t$

         - 在固定的时间段内重复的模式

      - 趋势项 $T_t$

         - 指标的基本趋势

      - 随机噪声项(剩余项) $R_t$

         - 季节性和趋势项被删除后原始时间序列的残差

   根据季节性项 $S_t$ 的变化, 分解方法可分为两种: 

      - 加法分解

         - $y_{t} = S_t + T_t + R_t$

      - 乘法分解
      
         - $y_{t} = S_t \times T_t \times R_t$, 等价于 $\ln y_{t} = \ln S_t + \ln T_t + \ln R_t$
         - 由于上面的等价关系, 所以, 有的时候在预测模型的时候, 会先取对数, 然后再进行时间序列的分解, 就能得到乘法的形式. 

## 加法模型
   
$$Y_{t} = T_{t} + S_{t} + C_{t} + I_{t}$$

其中: 

- $Y_{t}, T_{t}, S_{t}, C_{t}, I_{t}$ 均有相同的量纲
- $\sum_{t=1}^{k}S_{t}=0$, $k$ 为季节性周期长度
- $I_{t}$ 是独立随机变量序列, 服从正态分布

加法模型中的四种成分之间是相互独立的, 某种成分的变动不影响其他成分的变动. 
各个成分都用绝对量表示, 并且具有相同的量纲.

## 乘法模型

$$Y_{t} = T_{t} \times S_{t} \times C_{t} \times I_{t}$$

其中:

- $Y_{t}, T_{t}$ 有相同的量纲, $S_{t}$ 为季节性指数, $C_{t}$ 为循环指数, 两者皆为比例数
- $\sum_{t=1}^{k}S_{t}=k$, $k$ 为季节性周期长度
- $I_{t}$ 是独立随机变量序列, 服从正态分布

乘法模型中四种成分之间保持着相互依存的关系, 一般, 长期趋势用绝对量表示, 具有和时间序列本身相同的量纲, 其他成分则用相对量表示.

## 加法乘法混合模型

$$Y_{t} = T_{t} \times C_{t} \times S_{t} + I_{t}$$

其中: 

- $Y_{t}, T_{t}, C_{t}, I_{t}$ 有相同的量纲, $S_{t}$ 是季节指数, 为比例数
- $\sum_{t=1}^{k}S_{t} = k$, $k$ 为季节性周期长度
- $I_{t}$ 是独立随机变量序列, 服从正态分布

.. note:: 

很好地预测一个时间序列通常可能真的很困难, 但是如果

# 时间序列的分解方法

1. 运用移动平均法剔除长期趋势和周期变化, 得到序列 TC. 然后再用按月(季节)平均法求出季节指数 S.
2. 作散点图, 选择合适的曲线模型拟合序列的长期趋势, 得到长期趋势 T.
3. 计算周期因素 C. 用序列 TC 除以 T 即可得到周期变动因素 C.
4. 将时间序列的 T, S, C 分解出来后, 剩余的即为不规则变动, 即: $I=\frac{y}{TSC}$.

# 时间序列的长期趋势分析

## 移动平均法

$$M_{t}^{(1)}\frac{1}{N}(Y_{t}+Y_{t-1}+\cdots+Y_{t-N+1})$$

## 中心移动平均法

如果N为奇数, 则把N期的移动平均值作为中间一期的趋势值. 

$$M_{t-(N-1)/2}=\frac{1}{N}(Y_{t}+Y_{t-1}+L+Y_{t-N+1})$$

如果N为偶数, 则将移动平均数再进行一次两项移动平均. 


| ds  | Y             |
|-----|---------------|
| ds1 | $Y_{1}$ |
| ds2 | $Y_{2}$ |
| ds3 | $Y_{3}$ |
| ds4 | $Y_{4}$ |
| ds5 | $Y_{5}$ |

   
$$M^{(1)}=\frac{1}{4}(Y_{1}+Y_{2}+Y_{3}+Y_{4})$$
   
$$M^{(2)}=\frac{1}{4}(Y_{2}+Y_{3}+Y_{4}+Y_{5})$$

$$M=\frac{1}{2}(M^{(1)}+M^{(1)})$$

即

$$M_{t-N/2}=\frac{1}{N}(0.5\cdot Y_{t}+Y_{t-1}+\cdots+Y_{t-N+1}+0.5 \cdot Y_{t-N})$$


## 时间回归法

使用回归分析中的最小二乘法, 以时间 $t$ 或 $t$ 的函数为自变量拟合趋势方程. 常用的趋势方程有: 

线性方程: 

$$\hat{Y}=a + b\cdot t$$

多项式方程
   
$$\hat{Y}=a + b\cdot t + c \cdot t^{2}$$

指数方程: 
   
$$\hat{Y}=ab^{t}$$

# 时间序列季节变动分析

## 加法模型

## 乘法模型

乘法模型中的季节变动因素通过季节指数来反映. 常用的方法称为 **移动平均剔除法**. 步骤如下: 

1. 计算移动平均值 TC, 移动期数为 4 或 12 (N 为偶数)
2. 从序列中剔除移动平均值 $SI=\frac{Y}{T \times C}$
3. 季节指数 (S) = $\frac{同季平均数}{总季平均数} \times 100 %$

计算过程如下: 

- 计算长期趋势
- 剔除长期趋势


| ds     | Y   | 长期趋势 T | $\frac{Y}{T}$ |
|--------|-----|-----------|--------------|
| 2000.1 | 60  |            | 1.5                 |
| 2000.2 | 255 |            | 0.538               |
| 2000.3 | 270 | 180.000    | 0.561               |
| 2000.4 | 105 | 195.000    | 1.366               |
| 2001.1 | 120 | 213.000    | 1.512               |
| 2001.2 | 315 | 230.625    | 0.602               |
| 2001.3 | 360 | 238.125    | 0.511               |
| 2001.4 | 150 | 249.375    | 1.415               |
| 2002.1 | 135 | 264.375    | 1.412               |
| 2002.2 | 390 | 275.625    | 0.638               |
| 2002.3 | 405 | 286.875    | 0.539               |
| 2002.4 | 195 | 305.625    | 1.404               |
| 2003.1 | 180 | 333.750    | 1.443               |
| 2003.2 | 495 | 352.500    | 0.580               |
| 2003.3 | 525 | 363.750    | 0.564               |
| 2003.4 | 225 | 388.125    | 1.388               |
| 2004.1 | 240 | 425.625    |                     |
| 2004.2 | 630 | 453.750    |                     |
| 2004.3 | 690 |            |                     |
| 2004.4 | 285 |            |                     |


- 计算统计平均和总季平均, 计算季节指数


| ds       | 1季度  | 2季度   | 3季度   | 4季度  |
|----------|-------|---------|--------|-------|
| 2000     |        |         | 1.500   | 0.538  |
| 2001     | 0.561  | 1.366   | 1.512   | 0.602  |
| 2002     | 0.511  | 1.415   | 1.412   | 0.638  |
| 2003     | 0.539  | 1.404   | 1.443   | 0.580  |
| 2004     | 0.564  | 1.388   |         |        |
| 同季平均 | 0.544  | 1.393   | 1.467   | 0.589  |
| 总计平均 | 0.998  |         |         |        |
| 季节指数 | 54.47% | 139.57% | 146.92% | 59.04% |


# 时间序列周期性分析

## 加法模型

## 乘法模型

通过剩余法计算周期性成分 C:

1. 如果有季节成分, 计算季节指数 S, 得到季节调整后的数据 TCI
   - $TCI = \frac{T \times S \times C \times I}{S}$
2. 根据趋势方程从季节调整后的数据中消除长期趋势 T, 得到序列 CI
   - $CI = \frac{T \times S \times C \times I}{S \times T}$
3. 对消去季节成分和趋势值的序列 CI 进行移动平均以消除不规则波动, 得到周期性成分 C
   - $C = CI 移动平均$

计算过程如下: 

| ds       | Y        |Season(S) | $TCI = \frac{Y}{5}$  | $Trend(T) = a + bt$ | $CI=\frac{Y}{ST}$ | C        |
|----------|----------|----------|----------------------|---------------------|-------------------|----------|
| 2000.1   | 60       | 54.47    | 110.15               | 130.51              | 84.40             |          |
| 2000.2   | 255      | 139.57   | 182.70               | 148.35              | 123.15            | 106.04   |
| 2000.3   | 270      | 146.92   | 183.78               | 166.20              | 110.58            | 110.12   |
| 2000.4   | 105      | 59.04    | 177.84               | 184.04              | 96.63             | 105.44   |
| 2001.1   | 120      | 54.47    | 220.30               | 201.89              | 109.12            | 102.82   |
| 2001.1   | 315      | 139.57   | 225.69               | 219.73              | 102.71            | 104.99   |
| $\cdots$ | $\cdots$ | $\cdots$ | $\cdots$             | $\cdots$            | $\cdots$          | $\cdots$ |
| 2004.1   | 240      | 54.47    | 440.59               | 416.02              | 105.91            | 101.88   |
| 2004.2   | 630      | 139.57   | 451.39               | 433.87              | 104.04            | 104.64   |
| 2004.3   | 690      | 146.92   | 469.65               | 451.71              | 103.97            | 103.60   |
| 2004.4   | 285      | 59.04    | 482.71               | 469.56              | 102.80            |          |

# 时间序列不规则变动分析

## 加法模型

## 乘法模型

$$I=\frac{T\times S \times C \times I}{T \times S \times C}$$
