---
title: 互联网广告
author: 王哲峰
date: '2020-09-13'
slug: internet-ad
categories:
  - data analysis
tags:
  - model
---

<style>
details {
    border: 1px solid #aaa;
    border-radius: 4px;
    padding: .5em .5em 0;
}
summary {
    font-weight: bold;
    margin: -.5em -.5em 0;
    padding: .5em;
}
details[open] {
    padding: .5em;
}
details[open] summary {
    border-bottom: 1px solid #aaa;
    margin-bottom: .5em;
}
</style>

<details><summary>目录</summary><p>

- [互联网广告简史](#互联网广告简史)
  - [广告售卖方式历史](#广告售卖方式历史)
  - [计费方式历史](#计费方式历史)
- [互联网广告类型](#互联网广告类型)
  - [搜索广告](#搜索广告)
  - [定向广告](#定向广告)
  - [实时广告竞价](#实时广告竞价)
  - [广告系统架构](#广告系统架构)
- [计费模式](#计费模式)
- [两种广告](#两种广告)
- [转化漏斗](#转化漏斗)
- [eCPM 排序](#ecpm-排序)
- [CTR 和 CVR 预估](#ctr-和-cvr-预估)
</p></details><p></p>

# 互联网广告简史

## 广告售卖方式历史

* 显示广告(Display Advertising)
    - 互联网页面中的条幅(banner)广告
        - 工程师把HTML的代码嵌入到网站的某个位置, 没有复杂的在线计算
    - 合约广告(Agreement-based Advertising)
        - 采用合同约束的方式, 让某一广告位在某一段时间被特定广告主所独占
    - 位置、时间售卖
* 定向广告(Targetd Advertising)
    - 通过受众定向技术(Audience Targeting)分析用户的属性(User
      Profile)标签(性别、年龄...), 通过广告投放服务(Ad
      Server), 将原来静态的广告HTML代码转变为根据算法实时变换广告HTML代码, 返回给浏览器
* 担保式投放(Guarnateed Delivery)
    - 网站作为媒体方, 需要跟广告主保证一定量的投放量(页面或者时长)
    - 计费方式: CPM(Cost Per Mile)
* 竞价广告(Auction-based Advertising)
    - 广义一阶价格拍卖(GFP) - Overture(GoTo)
    - 广义二阶价格拍卖(GSP) - Google
        - 搜索广告(Search Ad)
            - 根据用户的搜索词进行定向, 然后投放相关的广告
        - 上下文广告(Contextual Ad)
            - 根据网页的上下文内容进行定向, 这种定向方式是假定用户的兴趣点跟当前的网页内容是相关的
            - 产生了根据用户历史行为进行定向的技术(Behavior Targeting)
    - 实时竞价(Real Time Bidding)
        - 改变了预先由广告主出价的模式, 改为每次请求的时候, 实时出价, 改变自己的流量
        - 广告交易平台(Ad Exchange)
            - 交易平台, 处于中间的角色, 一方面接入了流量, 另一方面接入了竞价的广告主
            - 需求方: 需求方平台(Demand Side Platform, DSP)
                - 广告主, 专门的技术公司
            - 提供方: 提供方平台(Supply Side Platform, SSP)
                - (小型)网站

## 计费方式历史

* CPM(Cost Per Mile)
   - 广告主要求: 大面积、稳定的曝光
* CPT(Cost Per Time)
   - 广告主要求增加曝光度
* CPC(Cost per Click)
   - 按照点击付费方式；能够让一些中小网站媒体获得了可以变现的方式
   - 广告主只想把流量引入到自己的网站
* CPS(Cost per Sale)
   - 只有在发生了销售的情况下, 广告主才付费；有力于广告主, 不用担心投资回报率的问题
   - 只想在成交的时候才付费

# 互联网广告类型

* 条幅广告(Banner Ad)
* 邮件直接营销广告(Email Direct Marketing Ad, EDMA)
* 富媒体广告(Rich Media Ad)
* 视屏广告(Video Ad)
* 文字链广告(Textual Ad)
* 社交广告(Social Ad)
* 移动端广告(Mobile Ad)

## 搜索广告


## 定向广告


## 实时广告竞价


## 广告系统架构





---

# 计费模式

互联网广告主要的计费模式 包括以下一些：

* CPM(Cost Per Mile, 按千次展示计费)
* CPC(Cost Per Click, 按用户点击计费)
* CPA(Cost Per Action, 按转化计费)
* oCPM(Optimized Cost Per Mile, 智能报价策略优化的按千次展示计费) 
* oCPC(Optimized Cost Per Click, 智能报价策略优化的按用户点击计费) 
* oCPA(Optimized Cost Per Action, 智能报价策略优化的按转化计费) 

这些计费模式可以分成 CPx 和 oCPx 两类，这两类实际上计费方式是一样的，主要差别在于报价方式不同：

例如 CPC 和 oCPC 都是按照点击量乘以点击单价进行结算。
主要区别在于 CPC 的点击单价报价是需要广告主自己根据自己的成本预算和收益预估进行调整的，
但是 oCPC 的点击单价报价是由广告平台系统根据广告主设计的优化目标(一般是平均转化成本)在一定价格范围内进行智能报价的，
对预估转化率高的流量提高报价，而对预估转化率低的流量降低报价，从而达到降低平均转化成本的目的。
实践中 oCPC 广告一般要先按照 CPC 广告的方式投放一段时间积累一定转化数据，
有足够多的转化数据后才能够进行第二阶段的 oCPC 智能报价

为什么会有这么多不同的计费模式呢，想象如下对话场景：

* 流量主(微信)说：我们微信就那么十几亿用户，每天朋友圈能够进行展现的广告量就那么几百亿，
  给你们曝光了就不能给别人曝光，曝光量反应我们的成本，当然应该按照曝光量(CPM)计费
* 广告主(游戏公司)说：你们绝大部分曝光都没有转化啊，没有转化对我来说等于0啊，
  我还给你广告费，这不是白嫖吗？按转化量(CPA)计费吧！
* 流量主(微信)说：我们给了你们那么多流量曝光，是你们这个游戏做的太辣鸡了，用户都不感兴趣，怪我咯？
* 广告主(游戏公司)说：你看看你们都把我们的游戏推给了一些什么用户啊，我们这是一款格斗类游戏，
  你们怎么还推给那么多的中老年大爷大妈，要多给小学生推啊！
* 流量主(微信)说：那我们折衷一下，按点击量计费(CPC)吧，用户既然都点击了，
  说明我们给你找的这个用户是精准的，用户最后有没有下载这个游戏就不是我们能够控制的了啊，
  广告文案是你们写的，游戏也是你们做的，你们自己去优化呀。这样 OK 吧？
* 广告主(游戏公司)说：那你们一个点击量收多少钱啊？
* 流量主(微信)说：你们可以自主报价，系统会拿你们的报价和其他广告主的报价进行竞价比较，
  最终平台预估收益最高的广告报价获得流量展示机会。
* 广告主(游戏公司)说：那是不是 CPC 报价最高就一定能拿到流量呢？
* 流量主(微信)说：也不一定，因为我们是按照点击量收费的，如果用户不点击的话我们不收钱，
  所以点击率和 CPC 报价的乘积才是我们平台的预估收益。如果你们的游戏和广告文案做得更好一些，
  点击率就更高一些，你们的 CPC 报价低一些也能够拿到流量，从而节约广告成本。
* 广告主(游戏公司)说：得了您，我们走一个试试。

(一个月后...)

* 广告主(游戏公司)说：我们上个月试了一下你们这个 CPC 报价，不是很好弄啊，
  调低了吧竞价阶段都拿不到流量，调高了吧感觉又很浪费钱，虽然现在也买了不少点击量了，
  但是转化率不高呢，你们那边有什么解决方案吗？
* 流量主(微信)说：你们可以试试我们的智能报价策略优化的按用户点击计费(oCPC)方式。
  你们设定能够接受的转化报价(CPA)范围，我们的智能系统会根据流量和你们广告的匹配程度进行智能报价，
  如果预估转化率高的，我们会相应调高报价，如果预估转化率低的，系统会降低报价，
  这样能够降低你们的平均转化成本，并且不用你们反复调价。
* 广告主(游戏公司)说：盖了帽儿了我的老baby。

# 两种广告

广告按其投放目的可以分成两类：效果广告和品牌广告

* 效果广告是为了直接提升某个产品的用户数量或者销售收入
* 品牌广告则是为了通过提升品牌知名度美誉度从而间接带来该品牌产品用户和销售收入的增长

大家所熟悉的互联网广告大部分都是效果广告。如：微信的朋友圈广告、百度搜索的竞价排名广告、
天猫淘宝的推荐商品广告、QQ/网易云音乐启动时的开屏广告、腾讯/爱奇艺视频中的贴片广告等等

# 转化漏斗

广告行业有一句名言：我知道我的广告费有一半是浪费的，遗憾的是，我不知道浪费的是哪一半

互联网场景下的效果广告通常存在着一个非常大的转化漏斗：曝光 —> 点击 —> 转化。
例如某款游戏 APP 在微信朋友圈的广告被曝光给了 1000 个用户，
然后有 100 个人点击了，最后这点击的 100 个人当中只有 5 个人最终下载了这个游戏 APP。
那么，这个游戏公司作为广告主应该给微信这个流量主付多少广告费呢？ 
是按照 1000 个曝光计费，还是 100 个点击计费，还是 5 个转化计费呢？

这取决于广告的计费模式

# eCPM 排序

现在的互联网广告平台很多时候都会给广告主非常灵活的广告投放计费策略供他们选择。
广告主可以选择 CPC 计费方式，为用户的点击付费，也可以选择 CPA 计费方式，
为用户最终的转化行为付费。如果投放的是品牌广告，只关注曝光量，
也可以选择 CPM 计费方式，以确定的价格直接购买曝光量。
当然，广告主还可以选择更加智能的报价方式如 oCPC, oCPM, oCPA

那么，这么多的广告，计费策略还不相同，
广告平台如何确定在特定场景下应该展现哪条广告才能获得最大收益呢？
答案是预估每种广告展现后的收益(eCPM：estimated Cost Per Mile)，
排序后选择其中最高的进行展现

假设微信朋友圈后台的待展现广告列表里有 3 条广告：

* 第一条广告 A 是一条 CPM 广告，广告主报价是 1 元，也就是每曝光 1000 次给支付 1 元
* 第二条广告 B 是一条 CPC 广告，广告主报价是 2 元，也就是用户每点击 1 次给广告平台支付 2 元
* 第三条广告 C 是一条 CPA 广告，广告主报价是 10 元，也就是每成功转化一个用户给广告平台支付 10 元
* 第四条广告 D 是一条 oCPC 广告，智能调价系统的出价是 3 元，也就是用户每点击 1 次给广告平台支付 3 元

现在有个家伙来刷朋友圈了，微信打算给他送个惊喜，曝光 1 条广告给他，恰点钱。
到底该曝光哪条广告给他才能获得最高的收益呢 ？

对于广告 A，其千次展现预估收益 eCPM 的计算非常简单：

eCPM(A) = CPM(A) = 1 元

对于广告 B，它的 eCPM 还取决于这个场景下用户对这条广告进行点击的概率 CTR(Click Through Rate)，
假定这个概率是 0.01：

eCPM(B) = 1000 *  CTR(B) * CPC(B) = 1000 * 0.01 * 2 = 20 元

对于广告 C，它的 eCPM 不仅取决于用户进行点击的概率 CTR，
还取决于用户点击后进行进一步下载 APP 或者购买商品等转化行为的概率 CVR(Convention Rate)，
假定广告 C 预估被用户点击的概率是 0.05，点击后转化的概率是 0.1

eCPM(C) = 1000 *  CTR(C) * CVR(C) * CPA(C) = 1000 * 0.05 * 0.1 * 10 = 50 元

对于广告 D，它的 eCPM 计算方式和 CPC 广告的计算方式是一样的，假定 CTR 概率是 0.02

eCPM(D) = 1000 *  CTR(D) * oCPC(D) = 1000 * 0.02 * 2 = 40 元

很显然，在这个场景下，这个广告位给广告 C 能够获得更好的预期收益，
这个预期收益是 50/1000 = 0.05 元

最后的成交价一般会取第二高报价的基础上加 0.1 元，所以，
假设这条广告最后发生了转化，广告主 C 应当支付 40.1/5=8.02 元

# CTR 和 CVR 预估

从 eCPM 的计算公式中可以看到，对于 CPC 广告，计算它的关键是准确地估计点击率 CTR。
而对于 CPA 广告，要计算 eCPM，不仅需要准确地估计点击率 CTR，还需要准确地估计转化率 CVR。
可以说，CTR 和 CVR 估计得准不准，直接决定了广告流量分发的效率，从而决定了广告平台的最终收益。

从算法角度来看，CTR 预估和 CVR 预估可以转换成一个二分类问题(点击还是没点击，转化还是没有转化)。
通常，CTR 预估使用的模型结构基本上和推荐系统中的精排阶段是一样的，
主要是要做好 user 和 item 的特征交叉，做好行为特征建模

但广告的 CTR/CVR 预估和推荐系统的精排有一点细微的差别，
推荐系统的精排业务上只关心这个排序的相对值，
但是广告系统的 CTR/CVR 预估是关心这预估概率的绝对值的。
因为推荐系统只要把用户更加喜欢的排在前面就行了，
至于内容 A 和内容 B 用户的喜欢程度相差多少，那个是不重要的

而广告系统有不同的广告，CPC 广告要和 CPM 广告竞价，
必须要知道 CPC 广告点击率 CTR 的绝对值才可以比较

所以，做 CTR/CVR 算法模型，如果对样本做了重采样，
会导致 CTR 预估概率偏离真实值，需要根据采样比例重新校正

